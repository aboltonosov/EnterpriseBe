#Область EVatService

&НаКлиенте
Функция ПодключитьEVatService() Экспорт 
	
	Попытка 
		
		EVatService = Новый ComОбъект("EInvVatService.Connector");
		
	Исключение
		
		ШаблонСообщения = НСтр("ru='Ошибка подключения EInvVatService: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ШаблонСообщения, ОписаниеОшибки());
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
		
		Возврат Неопределено;
		
	КонецПопытки;
	
	Если EVatService.Login("", 0) = 0 Тогда
		
		
		Если  EVatService.Connect(ЭлектронныеСчетаФактурыВызовСервера.АдресВебСервисаЭСЧФ()) = 0 Тогда 
			
			Возврат EVatService;
			
		Иначе
			
			ШаблонСообщения = НСтр("ru='Ошибка подключения к порталу vat.gov.by: %1'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ШаблонСообщения, EVatService.LastError);
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
			
			Возврат Неопределено; 
			
		КонецЕсли;
		
	Иначе
		
		ШаблонСообщения = НСтр("ru='Ошибка  авторизации на портале vat.gov.by: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ШаблонСообщения, EVatService.LastError);
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
		
		Возврат Неопределено;
		
	КонецЕсли;
	
КонецФункции

&НаКлиенте
Процедура ОтключитьEVatService(EVatService) Экспорт
	
	Попытка
		
		Если  EVatService.Disconnect <> 0 Тогда
			ШаблонСообщения = НСтр("ru='Ошибка при завершении подключения к порталу vat.gov.by: %1'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ШаблонСообщения, ОписаниеОшибки());
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
			Возврат;
		КонецЕсли;
		
		Если  EVatService.Logout <> 0 Тогда
			ШаблонСообщения = НСтр("ru='Ошибка при завершении авторизованной сессии на портале vat.gov.by: %1'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ШаблонСообщения, ОписаниеОшибки());
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
			Возврат;
		КонецЕсли;
			
	Исключение
		
		ШаблонСообщения = НСтр("ru='Ошибка при завершении сессии на портале vat.gov.by: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ШаблонСообщения, ОписаниеОшибки());
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
		
	КонецПопытки; 
			
КонецПроцедуры

#КонецОбласти 

