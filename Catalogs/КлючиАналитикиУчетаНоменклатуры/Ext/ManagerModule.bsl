#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

// Процедура устанавливает пометку на удаление для найденных элементов справочника.
//
// Параметры:
//	СтруктураПараметров - Структура - Параметры выбора элементов справочника
//	ПометкаУдаления - Булево - Признак установки пометки на удаление
//
Процедура УстановитьПометкуУдаления(СтруктураПараметров, ПометкаУдаления) Экспорт

	УстановитьПривилегированныйРежим(Истина);

	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	Таблица.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.КлючиАналитикиУчетаНоменклатуры КАК Таблица
	|ГДЕ
	|	Таблица.ПометкаУдаления <> &ПометкаУдаления
	|";
	Запрос = Новый Запрос;
	Если СтруктураПараметров.Свойство("Номенклатура") Тогда

		Запрос.УстановитьПараметр("Номенклатура", СтруктураПараметров.Номенклатура);
		ТекстЗапроса = ТекстЗапроса + " И Таблица.Номенклатура = &Номенклатура";

	КонецЕсли;
	Если СтруктураПараметров.Свойство("Характеристика") Тогда

		Запрос.УстановитьПараметр("Характеристика", СтруктураПараметров.Характеристика);
		ТекстЗапроса = ТекстЗапроса + " И Таблица.Характеристика = &Характеристика";

	КонецЕсли;
	Если СтруктураПараметров.Свойство("Серия") Тогда

		Запрос.УстановитьПараметр("Серия", СтруктураПараметров.Серия);
		ТекстЗапроса = ТекстЗапроса + " И Таблица.Серия = &Серия";

	КонецЕсли;
	Если СтруктураПараметров.Свойство("Склад") Тогда

		Запрос.УстановитьПараметр("Склад", СтруктураПараметров.Склад);
		ТекстЗапроса = ТекстЗапроса + " И Таблица.Склад = &Склад";

	КонецЕсли;
	Если СтруктураПараметров.Свойство("Назначение") Тогда

		Запрос.УстановитьПараметр("Назначение", СтруктураПараметров.Назначение);
		ТекстЗапроса = ТекстЗапроса + " И Таблица.Назначение = &Назначение";

	КонецЕсли;
	Если СтруктураПараметров.Свойство("СтатьяКалькуляции") Тогда

		Запрос.УстановитьПараметр("СтатьяКалькуляции", СтруктураПараметров.СтатьяКалькуляции);
		ТекстЗапроса = ТекстЗапроса + " И Таблица.СтатьяКалькуляции = &СтатьяКалькуляции";

	КонецЕсли;
	Запрос.УстановитьПараметр("ПометкаУдаления", ПометкаУдаления);

	Запрос.Текст = ТекстЗапроса;
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл

		Выборка.Ссылка.ПолучитьОбъект().УстановитьПометкуУдаления(ПометкаУдаления);

	КонецЦикла;

КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область ЗаменаДублейКлючейАналитики

Процедура ЗаменитьДублиКлючейАналитики() Экспорт
	
	Запрос = Новый Запрос("
	|ВЫБРАТЬ
	|	ДанныеСправочника.Ссылка КАК Ссылка,
	|	ДанныеСправочника.ПометкаУдаления КАК ПометкаУдаления,
	|	Аналитика.КлючАналитики КАК КлючАналитики
	|ИЗ
	|	Справочник.КлючиАналитикиУчетаНоменклатуры КАК ДанныеСправочника
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.АналитикаУчетаНоменклатуры КАК ДанныеРегистра
	|	ПО
	|		ДанныеСправочника.Ссылка = ДанныеРегистра.КлючАналитики
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|	ПО
	|		ДанныеСправочника.Номенклатура		= Аналитика.Номенклатура
	|		И ДанныеСправочника.Характеристика	= Аналитика.Характеристика
	|		И ДанныеСправочника.Серия			= Аналитика.Серия
	|		И ДанныеСправочника.Склад			= Аналитика.Склад
	|		И ДанныеСправочника.Назначение		= Аналитика.Назначение
	|		И ДанныеСправочника.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|ГДЕ
	|	ДанныеРегистра.КлючАналитики ЕСТЬ NULL
	|");
	
	// Сформируем соответствие ключей аналитики.
	СоответствиеАналитик = Новый Соответствие;
	
	РезультатЗапроса = Запрос.Выполнить();
	Если Не РезультатЗапроса.Пустой() Тогда
	
		Выборка = РезультатЗапроса.Выбрать();
		Пока Выборка.Следующий() Цикл
			
			СоответствиеАналитик.Вставить(Выборка.Ссылка, Выборка.КлючАналитики);
			
			Если Не Выборка.ПометкаУдаления Тогда
				СправочникОбъект = Выборка.Ссылка.ПолучитьОбъект();
				Попытка
					СправочникОбъект.УстановитьПометкуУдаления(Истина, Ложь);
				Исключение
					ВызватьИсключение;
				КонецПопытки;
			КонецЕсли;

		КонецЦикла;
		ОбщегоНазначенияУТ.ЗаменитьСсылки(СоответствиеАналитик);
	КонецЕсли;
		
КонецПроцедуры

#КонецОбласти

#Область ОбновлениеИнформационнойБазы

// Обработчик обновления УТ 11.3.1
// Регистрирует к обновлению ключи аналитики учета номенклатуры, которые надо пересоздать
// с учетом назначения из вида запасов.
Процедура ЗарегистрироватьДанныеКОбработкеДляПереходаНаНовуюВерсию(Параметры) Экспорт
	
	Запрос = Новый Запрос();
	ТекстЗапроса = ТекстЗапросаГенерацииКлючейКОбработке();
	Запрос.Текст = СтрЗаменить(ТекстЗапроса, "//ВыбиратьВсеКлючи", "И ЛОЖЬ");
	
	УстановитьПараметрыЗапросаКлючей(Запрос);
	
	Ключи = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Ссылка");
	
	ОбновлениеИнформационнойБазы.ОтметитьКОбработке(Параметры, Ключи);
	
КонецПроцедуры

// Метод возвращает текст запроса для выборки ключей к обновлению.
// Используется в обработчиках обновления.
Функция ТекстЗапросаГенерацииКлючейКОбработке() Экспорт
	Возврат "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Ключи.Аналитика КАК Ссылка,
	|	Ключи.Назначение КАК Назначение
	|//ПоместитьВТ
	|ИЗ
	|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ДвиженияНоменклатураДоходыРасходы КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ИспользуютсяВидыЗапасов
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ДвиженияНоменклатураНоменклатура КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ИспользуютсяВидыЗапасов
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.КорАналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ДвиженияНоменклатураНоменклатура КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.КорВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.КорАналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ИспользуютсяВидыЗапасов
	|		И &ОтборПоРегистратору
	|
	//++ НЕ УТКА
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.РаспоряженияНаВыпускПродукции КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И ДанныеРегистра.АналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		ДанныеРегистра.Назначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.РаспоряженияНаВыпускПродукции КАК ДанныеРегистра
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> ДанныеРегистра.Назначение
	|		И ДанныеРегистра.АналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	//-- НЕ УТКА
	//++ НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаПродукции КАК Аналитика,
	|		ДанныеРегистра.Назначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.РаспоряженияНаСписаниеПоНормативам КАК ДанныеРегистра
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаПродукции.Назначение <> ДанныеРегистра.Назначение
	|		И ДанныеРегистра.Назначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И ДанныеРегистра.АналитикаУчетаПродукции <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	//-- НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииТоваровОрганизаций КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.КорАналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииТоваровОрганизаций КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.КорВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.КорАналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ТоварыОрганизаций КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.КорАналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ТоварыОрганизаций КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.КорВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.КорАналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ТоварыОрганизацийКПередаче КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасовПродавца = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору

	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ИспользуютсяВидыЗапасов
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		ДанныеРегистра.Назначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.МатериалыИРаботыВПроизводстве КАК ДанныеРегистра
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> ДанныеРегистра.Назначение
	|		И ДанныеРегистра.Назначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И ДанныеРегистра.АналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаПродукции КАК Аналитика,
	|		ДанныеРегистра.Назначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.МатериалыИРаботыВПроизводстве КАК ДанныеРегистра
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаПродукции.Назначение <> ДанныеРегистра.Назначение
	|		И ДанныеРегистра.Назначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И ДанныеРегистра.АналитикаУчетаПродукции <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииЗатратНаВыпуск КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И ДанныеРегистра.АналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.КорАналитикаУчетаПродукции КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииЗатратНаВыпуск КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.КорВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.КорАналитикаУчетаПродукции.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И ДанныеРегистра.КорАналитикаУчетаПродукции <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииПроизводственныхЗатрат КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.КорАналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииПроизводственныхЗатрат КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.КорАналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииРасходовНаСебестоимостьТоваров КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		ВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрСведений.СтоимостьТоваров КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК ВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = ВидыЗапасов.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО ДанныеРегистра.АналитикаУчетаНоменклатуры = Ключи.Ссылка
	|	ГДЕ
	|		ВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И ВидыЗапасов.УдалитьНазначение <> Ключи.Назначение
	|		И &ИспользуютсяВидыЗапасов
	|
	//++ НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ВыпускПродукции КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаПродукции КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ВыпускПродукции КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаПродукции.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииНезавершенногоПроизводства КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаПродукции КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииНезавершенногоПроизводства КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.КорВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаПродукции.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаПродукции КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПрочиеРасходыНезавершенногоПроизводства КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.АналитикаУчетаПродукции.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.КорАналитикаУчетаПродукции КАК Аналитика,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ТрудозатратыНезавершенногоПроизводства КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ДанныеРегистра.КорВидЗапасовПродукции = СпрВидыЗапасов.Ссылка
	|	ГДЕ
	|		ДанныеРегистра.КорАналитикаУчетаПродукции.Назначение <> СпрВидыЗапасов.УдалитьНазначение
	|		И СпрВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И &ОтборПоРегистратору
	|
	//-- НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		ВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.СебестоимостьТоваров КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК ВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = ВидыЗапасов.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО ДанныеРегистра.АналитикаУчетаНоменклатуры = Ключи.Ссылка
	|	ГДЕ
	|		ВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И ВидыЗапасов.УдалитьНазначение <> Ключи.Назначение
	|		И &ИспользуютсяВидыЗапасов
	|		И &ОтборПоРегистратору
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.КорАналитикаУчетаНоменклатуры КАК Аналитика,
	|		КорВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.СебестоимостьТоваров КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК КорВидыЗапасов
	|		ПО ДанныеРегистра.КорВидЗапасов = КорВидыЗапасов.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК КорКлючи
	|		ПО ДанныеРегистра.КорАналитикаУчетаНоменклатуры = КорКлючи.Ссылка
	|	ГДЕ
	|		КорВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И КорВидыЗапасов.УдалитьНазначение <> КорКлючи.Назначение
	|		И &ИспользуютсяВидыЗапасов
	|		И &ОтборПоРегистратору
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		ВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.Закупки КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК ВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = ВидыЗапасов.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО ДанныеРегистра.АналитикаУчетаНоменклатуры = Ключи.Ссылка
	|	ГДЕ
	|		ВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И ВидыЗапасов.УдалитьНазначение <> Ключи.Назначение
	|		И &ОтборПоРегистратору
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.АналитикаУчетаНоменклатуры КАК Аналитика,
	|		ВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ТоварыОрганизацийКОформлению КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК ВидыЗапасов
	|		ПО ДанныеРегистра.ВидЗапасов = ВидыЗапасов.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО ДанныеРегистра.АналитикаУчетаНоменклатуры = Ключи.Ссылка
	|	ГДЕ
	|		ВидыЗапасов.УдалитьНазначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|		И ВидыЗапасов.УдалитьНазначение <> Ключи.Назначение
	|		И &ОтборПоРегистратору
	|	) КАК Ключи
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК СпрКлючи
	|	ПО Ключи.Аналитика = СпрКлючи.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаСНазначением
	|	ПО АналитикаСНазначением.Номенклатура = СпрКлючи.Номенклатура
	|		И АналитикаСНазначением.Характеристика = СпрКлючи.Характеристика
	|		И АналитикаСНазначением.Серия = СпрКлючи.Серия
	|		И АналитикаСНазначением.Склад = СпрКлючи.Склад
	|		И АналитикаСНазначением.СтатьяКалькуляции = СпрКлючи.СтатьяКалькуляции
	|		И АналитикаСНазначением.Назначение = Ключи.Назначение
	|ГДЕ
	|	АналитикаСНазначением.КлючАналитики ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	КлючиБезНазначения.Ссылка КАК Ссылка,
	|	Ключи.Назначение КАК Назначение
	|ИЗ
	|	Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК КлючиБезНазначения
	|	ПО КлючиБезНазначения.Номенклатура = Ключи.Номенклатура
	|		И КлючиБезНазначения.Характеристика = Ключи.Характеристика
	|		И КлючиБезНазначения.Серия = Ключи.Серия
	|		И КлючиБезНазначения.Склад = Ключи.Склад
	|		И КлючиБезНазначения.СтатьяКалькуляции = Ключи.СтатьяКалькуляции
	|		И КлючиБезНазначения.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|ГДЕ
	|	Ключи.Назначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|	//ВыбиратьВсеКлючи
	|;
	|////////////////////////////////////////////
	|";
КонецФункции

Функция ТекстЗапросаГенерацииКлючейАналитикиУчетаНоменклатуры() Экспорт
	ТекстЗапроса = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Ключи.Номенклатура КАК Номенклатура,
	|	Ключи.Характеристика КАК Характеристика,
	|	Ключи.Серия КАК Серия,
	|	Ключи.Склад КАК Склад,
	|	Ключи.Назначение КАК Назначение
	|ИЗ
	|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		ЕСТЬNULL(Движения.ВидЗапасов.УдалитьНазначение, 
	|			ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)) КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ДвиженияНоменклатураДоходыРасходы КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ДвиженияНоменклатураНоменклатура КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ДвиженияНоменклатураНоменклатура КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.КорАналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.КорВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.КорАналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	//++ НЕ УТКА
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура                    КАК Номенклатура,
	|		Ключи.Характеристика                  КАК Характеристика,
	|		Ключи.Серия                           КАК Серия,
	|		Ключи.Склад                           КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение      КАК Назначение
	|	ИЗ
	|		РегистрНакопления.РаспоряженияНаВыпускПродукции КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура                    КАК Номенклатура,
	|		Ключи.Характеристика                  КАК Характеристика,
	|		Ключи.Серия                           КАК Серия,
	|		Ключи.Склад                           КАК Склад,
	|		Движения.Назначение                   КАК Назначение
	|	ИЗ
	|		РегистрНакопления.РаспоряженияНаВыпускПродукции КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Движения.Назначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура                    КАК Номенклатура,
	|		Ключи.Характеристика                  КАК Характеристика,
	|		Ключи.Серия                           КАК Серия,
	|		Движения.Подразделение                КАК Склад,
	|		Движения.Назначение                   КАК Назначение
	|	ИЗ
	|		РегистрНакопления.РаспоряженияНаВыпускПродукции КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Движения.Подразделение = Аналитика.Склад
	|			И Движения.Назначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|
	//-- НЕ УТКА
	//++ НЕ УТ
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура                    КАК Номенклатура,
	|		Ключи.Характеристика                  КАК Характеристика,
	|		Ключи.Серия                           КАК Серия,
	|		Ключи.Склад                           КАК Склад,
	|		Движения.Назначение                   КАК Назначение
	|	ИЗ
	|		РегистрНакопления.РаспоряженияНаСписаниеПоНормативам КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаПродукции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Движения.Назначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаПродукции = &КлючАналитики
	//-- НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.СебестоимостьТоваров КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура                КАК Номенклатура,
	|		Ключи.Характеристика              КАК Характеристика,
	|		Ключи.Серия                       КАК Серия,
	|		Ключи.Склад                       КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.СебестоимостьТоваров КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.КорАналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.КорВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.КорАналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииТоваровОрганизаций КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииТоваровОрганизаций КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.КорАналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.КорВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.КорАналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ТоварыОрганизаций КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ТоварыОрганизаций КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.КорАналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.КорВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.КорАналитикаУчетаНоменклатуры = &КлючАналитики
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ТоварыОрганизацийКПередаче КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасовПродавца
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		Движения.Назначение            КАК Назначение
	|	ИЗ
	|		РегистрНакопления.МатериалыИРаботыВПроизводстве КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Движения.Назначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		Движения.Назначение            КАК Назначение
	|	ИЗ
	|		РегистрНакопления.МатериалыИРаботыВПроизводстве КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаПродукции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Движения.Назначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаПродукции = &КлючАналитики
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииЗатратНаВыпуск КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура                КАК Номенклатура,
	|		Ключи.Характеристика              КАК Характеристика,
	|		Ключи.Серия                       КАК Серия,
	|		Ключи.Склад                       КАК Склад,
	|		Движения.КорВидЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииЗатратНаВыпуск КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.КорАналитикаУчетаПродукции
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.КорВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.КорАналитикаУчетаПродукции = &КлючАналитики
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииПроизводственныхЗатрат КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииПроизводственныхЗатрат КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.КорАналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.КорАналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииРасходовНаСебестоимостьТоваров КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура                    КАК Номенклатура,
	|		Ключи.Характеристика                  КАК Характеристика,
	|		Ключи.Серия                           КАК Серия,
	|		Ключи.Склад                           КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение      КАК Назначение
	|	ИЗ
	|		РегистрСведений.СтоимостьТоваров КАК Движения
	|	
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.Закупки КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ТоварыОрганизацийКОформлению КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	//++ НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ВыпускПродукции КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ВыпускПродукции КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаПродукции
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаПродукции = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииНезавершенногоПроизводства КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаНоменклатуры
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаНоменклатуры = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура                КАК Номенклатура,
	|		Ключи.Характеристика              КАК Характеристика,
	|		Ключи.Серия                       КАК Серия,
	|		Ключи.Склад                       КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение  КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПартииНезавершенногоПроизводства КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаПродукции
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.КорВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаПродукции = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура             КАК Номенклатура,
	|		Ключи.Характеристика           КАК Характеристика,
	|		Ключи.Серия                    КАК Серия,
	|		Ключи.Склад                    КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ПрочиеРасходыНезавершенногоПроизводства КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.АналитикаУчетаПродукции
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.ВидЗапасов
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.АналитикаУчетаПродукции = &КлючАналитики
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Ключи.Номенклатура                КАК Номенклатура,
	|		Ключи.Характеристика              КАК Характеристика,
	|		Ключи.Серия                       КАК Серия,
	|		Ключи.Склад                       КАК Склад,
	|		СпрВидыЗапасов.УдалитьНазначение  КАК Назначение
	|	ИЗ
	|		РегистрНакопления.ТрудозатратыНезавершенногоПроизводства КАК Движения
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Ключи.Ссылка = Движения.КорАналитикаУчетаПродукции
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО СпрВидыЗапасов.Ссылка = Движения.КорВидЗапасовПродукции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО Ключи.Номенклатура = Аналитика.Номенклатура
	|			И Ключи.Характеристика = Аналитика.Характеристика
	|			И Ключи.Серия = Аналитика.Серия
	|			И Ключи.Склад = Аналитика.Склад
	|			И Ключи.СтатьяКалькуляции = Аналитика.СтатьяКалькуляции
	|			И СпрВидыЗапасов.УдалитьНазначение = Аналитика.Назначение
	|	ГДЕ
	|		Аналитика.КлючАналитики ЕСТЬ NULL
	|		И Движения.КорАналитикаУчетаПродукции = &КлючАналитики
	//-- НЕ УТ
	|	) КАК Ключи
	|";
	Возврат ТекстЗапроса;
КонецФункции

Процедура ОбработатьДанныеДляПереходаНаНовуюВерсию(Параметры) Экспорт
	
	ПолноеИмяСправочника = Метаданные.Справочники.КлючиАналитикиУчетаНоменклатуры.ПолноеИмя();
	ПолноеИмяРегистра = Метаданные.РегистрыСведений.АналитикаУчетаНоменклатуры.ПолноеИмя();
	
	ДополнительныеПараметрыВыборкиДанных = ОбновлениеИнформационнойБазы.ДополнительныеПараметрыВыборкиДанныхДляОбработки();
	ДополнительныеПараметрыВыборкиДанных.ВыбиратьПорциями = Ложь;
	
	Выборка = ОбновлениеИнформационнойБазы.ВыбратьСсылкиДляОбработки(Параметры.Очередь, ПолноеИмяСправочника, ДополнительныеПараметрыВыборкиДанных);
	Пока Выборка.Следующий() Цикл
		
		НачатьТранзакцию();
		
		Блокировка = Новый БлокировкаДанных;
		ЭлементБлокировки = Блокировка.Добавить(ПолноеИмяСправочника);
		ЭлементБлокировки.УстановитьЗначение("Ссылка", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ДвиженияНоменклатураДоходыРасходы");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ДвиженияНоменклатураНоменклатура");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ДвиженияНоменклатураНоменклатура");
		ЭлементБлокировки.УстановитьЗначение("КорАналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.СебестоимостьТоваров");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ПартииТоваровОрганизаций");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ТоварыОрганизаций");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ВыручкаИСебестоимостьПродаж");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.МатериалыИРаботыВПроизводстве");
		ЭлементБлокировки.УстановитьЗначение("УдалитьАналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ПартииЗатратНаВыпуск");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ПартииЗатратНаВыпуск");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаПродукции", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ПартииПроизводственныхЗатрат");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрСведений.СтоимостьТоваров");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ТоварыОрганизацийКПередаче");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ТоварыОрганизацийКПередаче");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.Закупки");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Разделяемый;
		
		//++ НЕ УТ
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ВыпускПродукции");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
		
		ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ПартииНезавершенногоПроизводства");
		ЭлементБлокировки.УстановитьЗначение("АналитикаУчетаНоменклатуры", Выборка.Ссылка);
		ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
		//-- НЕ УТ
		
		Блокировка.Заблокировать();
		
		Запрос = Новый Запрос();
		Запрос.Текст = ТекстЗапросаГенерацииКлючейАналитикиУчетаНоменклатуры();
		Запрос.УстановитьПараметр("КлючАналитики", Выборка.Ссылка);
		
		Ключи = Запрос.Выполнить().Выбрать();
		Пока Ключи.Следующий() Цикл
			Попытка
				РегистрыСведений.АналитикаУчетаНоменклатуры.СоздатьКлючАналитики(Ключи);
			Исключение
				ТекстСообщения = НСтр("ru = 'Не удалось инициализировать ключ аналитики учета номенклатуры: %Ключ% по причине: %Причина%'");
				ТекстСообщения = СтрЗаменить(ТекстСообщения, "%Ключ%", Выборка.Ссылка);
				ТекстСообщения = СтрЗаменить(ТекстСообщения, "%Причина%", ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
				ЗаписьЖурналаРегистрации(ОбновлениеИнформационнойБазы.СобытиеЖурналаРегистрации(), УровеньЖурналаРегистрации.Ошибка,
					Выборка.Ссылка.Метаданные(), ТекстСообщения);
				КонецПопытки;
		КонецЦикла;
		ОбновлениеИнформационнойБазы.ОтметитьВыполнениеОбработки(Выборка.Ссылка);
		ЗафиксироватьТранзакцию();
		
	КонецЦикла;
	
	Параметры.ОбработкаЗавершена = Не ОбновлениеИнформационнойБазы.ЕстьДанныеДляОбработки(Параметры.Очередь, ПолноеИмяСправочника);
	
КонецПроцедуры

// Устанавливает обязательные параметры для запроса из метода ТекстЗапросаГенерацииКлючейКОбработке
Процедура УстановитьПараметрыЗапросаКлючей(Запрос) Экспорт
	Запрос.УстановитьПараметр("ИспользуютсяВидыЗапасов", Константы.УчитыватьСебестоимостьТоваровПоВидамЗапасов.Получить());
	Запрос.УстановитьПараметр("ОтборПоРегистратору", Истина);
КонецПроцедуры
	
#КонецОбласти

#КонецОбласти

#КонецЕсли