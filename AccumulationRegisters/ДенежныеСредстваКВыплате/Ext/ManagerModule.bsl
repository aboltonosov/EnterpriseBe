#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область СлужебныеПроцедурыИФункции

#Область ОбновлениеИнформационнойБазы

Процедура ЗарегистрироватьДанныеКОбработкеДляПереходаНаНовуюВерсию(Параметры) Экспорт
	
	ИмяРегистра       = "ДенежныеСредстваКВыплате";
	ПолноеИмяРегистра = "РегистрНакопления." + ИмяРегистра;
	
	Регистраторы = Новый Массив;
	Регистраторы.Добавить("Документ.ЗаявкаНаРасходованиеДенежныхСредств");
	Регистраторы.Добавить("Документ.РаспоряжениеНаПеремещениеДенежныхСредств");
	Регистраторы.Добавить("Документ.СписаниеБезналичныхДенежныхСредств");
	Регистраторы.Добавить("Документ.РасходныйКассовыйОрдер");
	Регистраторы.Добавить("Документ.ОперацияПоПлатежнойКарте");
	Регистраторы.Добавить("Документ.ПриходныйКассовыйОрдер");
	Регистраторы.Добавить("Документ.ПоступлениеБезналичныхДенежныхСредств");
	
	Для каждого Регистратор из Регистраторы Цикл
		Менеджер = ОбщегоНазначения.МенеджерОбъектаПоПолномуИмени(Регистратор);
		ТекстЗапроса = Менеджер.АдаптированныйТекстЗапросаДвиженийПоРегистру(ИмяРегистра);
		ДокументыКПерепроведению = ОбновлениеИнформационнойБазыУТ.РегистраторыДляПерепроведения(ТекстЗапроса, ПолноеИмяРегистра, Регистратор);
		ОбновлениеИнформационнойБазы.ОтметитьРегистраторыКОбработке(Параметры, ДокументыКПерепроведению, ПолноеИмяРегистра);
	КонецЦикла;
	
КонецПроцедуры

Процедура ОбработатьДанныеДляПереходаНаНовуюВерсию(Параметры) Экспорт
	
	ОбработкаЗавершена = Ложь;
	
	Регистраторы = Новый Массив;
	Регистраторы.Добавить("Документ.ЗаявкаНаРасходованиеДенежныхСредств");
	Регистраторы.Добавить("Документ.РаспоряжениеНаПеремещениеДенежныхСредств");
	
	ОбновлениеИнформационнойБазыУТ.ПерезаписатьДвиженияИзОчереди(
		Регистраторы,
		"РегистрНакопления.ДенежныеСредстваКВыплате",
		Параметры.Очередь);
		
	ВыборкаЗаявок = ОбновлениеИнформационнойБазы.ВыбратьРегистраторыРегистраДляОбработки(
		Параметры.Очередь,
		"Документ.ЗаявкаНаРасходованиеДенежныхСредств",
		"РегистрНакопления.ДенежныеСредстваКВыплате");
		
	ВыборкаРаспоряжений = ОбновлениеИнформационнойБазы.ВыбратьРегистраторыРегистраДляОбработки(
		Параметры.Очередь,
		"Документ.ЗаявкаНаРасходованиеДенежныхСредств",
		"РегистрНакопления.ДенежныеСредстваКВыплате");
		
	Если Не ВыборкаЗаявок.Следующий() И Не ВыборкаРаспоряжений.Следующий() Тогда
		
		Регистраторы = Новый Массив;
		Регистраторы.Добавить("Документ.СписаниеБезналичныхДенежныхСредств");
		Регистраторы.Добавить("Документ.РасходныйКассовыйОрдер");
		Регистраторы.Добавить("Документ.ОперацияПоПлатежнойКарте");
		Регистраторы.Добавить("Документ.ПриходныйКассовыйОрдер");
		Регистраторы.Добавить("Документ.ПоступлениеБезналичныхДенежныхСредств");
		
		ОбработкаЗавершена = ОбновлениеИнформационнойБазыУТ.ПерезаписатьДвиженияИзОчереди(
			Регистраторы,
			"РегистрНакопления.ДенежныеСредстваКВыплате",
			Параметры.Очередь);
	КонецЕсли;
	
	Параметры.ОбработкаЗавершена = ОбработкаЗавершена;
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти

#КонецЕсли