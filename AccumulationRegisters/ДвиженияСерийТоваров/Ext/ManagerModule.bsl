#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область СлужебныеПроцедурыИФункции

#Область ОбновлениеИнформационнойБазы

Процедура ЗарегистрироватьДанныеКОбработкеДляПереходаНаНовуюВерсию(Параметры) Экспорт
	
	ПолноеИмяРегистра = "РегистрНакопления.ДвиженияСерийТоваров";
	ИмяРегистра = СтрРазделить(ПолноеИмяРегистра, ".")[1];
	
	ПолноеИмяДокумента = "Документ.МаркировкаТоваровГИСМ";
	ИмяДокумента = СтрРазделить(ПолноеИмяДокумента, ".")[1];
	ТекстЗапросаМеханизмаПроведения = МаркировкаТоваровГИСМУТ.АдаптированныйТекстЗапросаДвиженийПоРегиструМаркировкаТоваров(ИмяРегистра);
	Регистраторы = ОбновлениеИнформационнойБазыУТ.РегистраторыДляПерепроведения(
							ТекстЗапросаМеханизмаПроведения,
							ПолноеИмяРегистра,
							ПолноеИмяДокумента);
							
	ОбновлениеИнформационнойБазы.ОтметитьРегистраторыКОбработке(Параметры, Регистраторы, ПолноеИмяРегистра);
	
	ПолноеИмяДокумента = "Документ.ПеремаркировкаТоваровГИСМ";
	ИмяДокумента = СтрРазделить(ПолноеИмяДокумента, ".")[1];
	ТекстЗапросаМеханизмаПроведения = МаркировкаТоваровГИСМУТ.АдаптированныйТекстЗапросаДвиженийПоРегиструПеремаркировкаТоваров(ИмяРегистра);
	Регистраторы = ОбновлениеИнформационнойБазыУТ.РегистраторыДляПерепроведения(
							ТекстЗапросаМеханизмаПроведения,
							ПолноеИмяРегистра,
							ПолноеИмяДокумента);
							
	ОбновлениеИнформационнойБазы.ОтметитьРегистраторыКОбработке(Параметры, Регистраторы, ПолноеИмяРегистра);
	
	//++ НЕ УТКА
	СписокДокументов = Новый Массив;
	СписокДокументов.Добавить("Документ.ПроизводственнаяОперация2_2");
	СписокДокументов.Добавить("Документ.ЭтапПроизводства2_2");
	
	Для каждого ПолноеИмяДокумента Из СписокДокументов Цикл
		
		ИмяДокумента = СтрРазделить(ПолноеИмяДокумента, ".")[1];
		
		ТекстЗапросаМеханизмаПроведения = Документы[ИмяДокумента].АдаптированныйТекстЗапросаДвиженийПоРегистру(ИмяРегистра);
		
		Регистраторы = ОбновлениеИнформационнойБазыУТ.РегистраторыДляПерепроведения(
			ТекстЗапросаМеханизмаПроведения,
			ПолноеИмяРегистра,
			ПолноеИмяДокумента);
		
		ОбновлениеИнформационнойБазы.ОтметитьРегистраторыКОбработке(Параметры, Регистраторы, ПолноеИмяРегистра);
		
	КонецЦикла;
	//-- НЕ УТКА
	
КонецПроцедуры

Процедура ОбработатьДанныеДляПереходаНаНовуюВерсию(Параметры) Экспорт
	
	ПолноеИмяРегистра = "РегистрНакопления.ДвиженияСерийТоваров";
	
	РегистраторыГИСМ = Новый Массив;
	РегистраторыГИСМ.Добавить("Документ.МаркировкаТоваровГИСМ");
	РегистраторыГИСМ.Добавить("Документ.ПеремаркировкаТоваровГИСМ");
	
	ДополнительныеПараметры = ОбновлениеИнформационнойБазыУТ.ДополнительныеПараметрыПерезаписиДвиженийИзОчереди();
	ДополнительныеПараметры.Менеджер = МаркировкаТоваровГИСМУТ;
	
	ОбновлениеИнформационнойБазыУТ.ПерезаписатьДвиженияИзОчереди(
																РегистраторыГИСМ,
																ПолноеИмяРегистра,
																Параметры.Очередь,
																ДополнительныеПараметры);
		
	//++ НЕ УТКА
	Регистраторы = Новый Массив;
	Регистраторы.Добавить("Документ.ПроизводственнаяОперация2_2");
	Регистраторы.Добавить("Документ.ЭтапПроизводства2_2");
	
	ОбновлениеИнформационнойБазыУТ.ПерезаписатьДвиженияИзОчереди(
																Регистраторы,
																ПолноеИмяРегистра,
																Параметры.Очередь);
	//-- НЕ УТКА
	
	Параметры.ОбработкаЗавершена = Не ОбновлениеИнформационнойБазы.ЕстьДанныеДляОбработки(
		Параметры.Очередь,
		ПолноеИмяРегистра);
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти

#КонецЕсли