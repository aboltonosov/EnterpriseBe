#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
	
#Область ОбработчикиСобытий

Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	НастройкиОтчета = КомпоновщикНастроек.ПолучитьНастройки();
	ВнешниеНаборы = Новый Структура;
	
	Отчеты.ПотребностьВМатериалахПоМоделиГрафикаПроизводства.НастроитьНаборыДанных(
		СхемаКомпоновкиДанных, НастройкиОтчета, ВнешниеНаборы);
	
	// Компоновка и вывод.
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
	МакетКомпоновки = КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных, НастройкиОтчета, ДанныеРасшифровки);

	КомпоновкаДанныхСервер.УстановитьЗаголовкиМакетаКомпоновки(ПолучитьСтруктуруЗаголовковПолей(), МакетКомпоновки);
	
	ПроцессорКомпоновки = Новый ПроцессорКомпоновкиДанных;
	ПроцессорКомпоновки.Инициализировать(МакетКомпоновки, ВнешниеНаборы, ДанныеРасшифровки, Истина);
	
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	ПроцессорВывода.УстановитьДокумент(ДокументРезультат);
	ПроцессорВывода.Вывести(ПроцессорКомпоновки);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция ПолучитьСтруктуруЗаголовковПолей()
	
	СтруктураЗаголовков = КомпоновкаДанныхСервер.СтруктураЗаголовковПолейЕдиницИзмерений(КомпоновщикНастроек);
	Для каждого Элемент Из СтруктураЗаголовков Цикл
		Если ТипЗнч(Элемент.Значение) = Тип("Строка")
			И НЕ Найти(Элемент.Значение, НСтр("ru='товар'"))=0 Тогда
			
			СтруктураЗаголовков.Вставить(
				Элемент.Ключ,
				СтрЗаменить(Элемент.Значение, НСтр("ru='товар'"), НСтр("ru='материал'")));
			
		КонецЕсли;
	КонецЦикла;
	
	Возврат СтруктураЗаголовков;
	
КонецФункции

#КонецОбласти

#КонецЕсли
